function Taboo(){this._data=[],_.mixin({zipArrays:function(t){return _.zip.apply(_,t)}}),this.metadata={},this._callbacks={},this.addRow=function(t,e){this.addRows([t],e)},this.addRows=function(t,e){var n={printColumnSize:15},a={};_.isObject(e)?_.extend(a,n,e):a=n;var i=this;t.forEach(function(t,e){var n=i.getColumnHeaders();if(_.isArray(t))t.forEach(function(t,e){e<n.length&&i._addCell(n[e],t)}),i._clean();else if(_.isObject(t)){var a=_.keys(t);i.addColumns(a,{silent:!0,ignoreDuplicates:!0}),_.pairs(t).forEach(function(t,e){i._addCell(t[0],t[1])}),i._clean()}}),a.silent||this.triggerCallbacks("update")},this.addColumn=function(t,e){this.addColumns([t],e)},this.addColumns=function(t,e){var n={silent:!1,ignoreDuplicates:!1},a={};_.isObject(e)?_.extend(a,n,e):a=n;var i,r=this;i=a.ignoreDuplicates?_.difference(t,this.getColumnHeaders()):t,i.forEach(function(t,e){r._data.push({header:t,data:[]})}),this._clean(),a.silent||this.triggerCallbacks("update")},this.updateWhere=function(t,e,n){var a={silent:!1},i={};_.isObject(n)?_.extend(i,a,n):i=a;var r=_.keys(t)[0],s=_.values(t)[0],c=_.find(this._data,function(t){return t.header===r});return _.isUndefined(c)?void 0:(_.chain(this._getRowsAsCellObjects()).map(function(t,n){var a=_.every(_.map(e,function(e){return!_.isEmpty(_.where(t,{header:_.keys(e)[0],data:_.values(e)[0]}))}));return a?n:void 0}).filter(function(t){return!_.isUndefined(t)}).each(function(t){c.data[t]=s}).value(),void(i.silent||this.triggerCallbacks("update")))},this.clear=function(t){var e={silent:!1},n={};_.isObject(t)?_.extend(n,e,t):n=e,this._data=[],n.silent||this.triggerCallbacks("update")},this.getColumnHeaders=function(){return _.map(this._data,function(t){return t.header})},this.getColumn=function(t){var e;return this._data.forEach(function(n,a){n.header==t&&(e=n.data)}),e},this.getRowAtIndex=function(t,e){var n={objects:!0},a={};if(_.isObject(e)?_.extend(a,n,e):a=n,t>this._data[0].data.length)return console.error("getRowAtIndex(): Index out of range"),[];var i=_.map(this._data,function(e,n){return{header:e.header,data:e.data[t]}});return a.objects?i:_.pluck(i,"data")},this.getRows=function(t){var e={objects:!0},n={};return _.isObject(t)?_.extend(n,e,t):n=e,n.objects?n.objects?_.chain(this._getRowsAsCellObjects()).map(function(t,e){return _.reduce(t,function(t,e){var n={};return n[e.header]=e.data,_.extend(t,n)},{})}).value():void 0:_.chain(this._data).map(function(t){return t.data}).zipArrays().value()},this.getRowsWhere=function(t,e){var n={objects:!0},a={};_.isObject(e)?_.extend(a,n,e):a=n;var i=_.pairs(t);return _.chain(this._getRowsAsCellObjects()).filter(function(t){return _.every(_.map(i,function(e){return!_.isEmpty(_.where(t,{header:e[0],data:e[1]}))}))}).map(function(t,e){return a.objects?_.reduce(t,function(t,e){var n={};return n[e.header]=e.data,_.extend(t,n)},{}):_.map(t,function(t){return t.data})}).value()},this.deleteRowAtIndex=function(t,e){var n={silent:!1},a={};_.isObject(e)?_.extend(a,n,e):a=n;var i=this;_.each(i._data,function(e,n){e.data.splice(t,1)}),a.silent||this.triggerCallbacks("update")},this.deleteRowsWhere=function(t,e){var n={silent:!1},a={};_.isObject(e)?_.extend(a,n,e):a=n;var i=this,r=_.chain(this._getRowsAsCellObjects()).map(function(e,n){var a=_.every(_.map(_.pairs(t),function(t){return!_.isEmpty(_.where(e,{header:t[0],data:t[1]}))}));return a?n:void 0}).filter(function(t){return!_.isUndefined(t)}).sort().reverse().each(function(t){i.deleteRowAtIndex(t)}).reduce(function(t,e){return t+1},0).value();return a.silent||this.triggerCallbacks("update"),r},this.columnToObjects=function(t){var e=_.unique(this.getColumn(t)),n=_.map(e,function(t,e){return{name:t,related:{},_index:e}}),a=this._getRowsAsCellObjects();return n.forEach(function(t,e){a.forEach(function(e,n){var a=_.find(e,function(e){return t.name===e.data});if("undefined"!=typeof a){var i=_.reject(e,function(t){return t==a});i.forEach(function(e){"undefined"==typeof t.related[e.header]&&(t.related[e.header]=e.data)})}})}),n},this.numberOfColumns=function(){return this._data.length},this.numberOfRows=function(){return 0===this._data.length?0:this._data[0].data.length},this.print=function(t){var e={printColumnSize:15},n={};_.isObject(t)?_.extend(n,e,t):n=e;var a=n.printColumnSize,i="\n",r=[];return 0===this._data.length?"":(this._data.forEach(function(t){var e=String(t.header);r.push(Math.max(e.length,a)),i+=e+new Array(Math.max(e.length,a)-(e.length-1)).join(" ")+" | "}),i+="\n",this._getRowsAsCellObjects().forEach(function(t,e,n){_.each(t,function(t,e){var n,a=String(t.data);if(a.length>r[e])n=a.slice(0,r[e]-3),n+="...";else if(a.length<r[e]){var s=new Array(r[e]-(a.length-1)).join(" ");n=a+s}else n=a;i+=n+" | "}),i+="\n"}),i+="\n")},this.leftJoin=function(t,e,n){var a,i=this,r=i.getColumnHeaders(),s=e.getColumnHeaders(),c=e,o=new Taboo;if(!_.contains(r,t))return o;if(!_.contains(s,n))return this.clone();var u=this._fixInterTableHeaderCollisions(i,c,[n]);return i=u[0],c=u[1],i._getRowsAsCellObjects().forEach(function(e,i){a=!1;var r=_.find(e,function(e){return e.header===t});c._getRowsAsCellObjects().forEach(function(t,i,s){var c=_.find(t,function(t){return t.header===n});if(_.isEqual(c.data,r.data)){var u=_.reject(t,function(t){return _.isEqual(t.data,r.data)});o._addRowCellObjects(e.concat(u)),a=!0}}),a===!1&&o._addRowCellObjects(e)}),o},this.innerJoin=function(t,e,n){var a,i=this,r=i.getColumnHeaders(),s=e.getColumnHeaders(),c=e.clone(),o=new Taboo;if(!_.contains(r,t)||!_.contains(s,n))return o;var u=this._fixInterTableHeaderCollisions(i,c,[n]);return i=u[0],c=u[1],i._getRowsAsCellObjects().forEach(function(e,i){a=!1;var r=_.find(e,function(e){return e.header===t});c._getRowsAsCellObjects().forEach(function(t,a,i){var s=_.find(t,function(t){return t.header===n});if(_.isEqual(s.data,r.data)){var c=_.reject(t,function(t){return _.isEqual(t.data,r.data)}),u=e.concat(c);o._addRowCellObjects(u)}})}),o},this.clone=function(){var t=JSON.parse(JSON.stringify(this._data)),e=new Taboo;return e._data=t,e},this.setData=function(t){this._data=t,this._clean()},this.getData=function(){return this._data},this.callbackEventNames=["update"],this.registerCallback=function(t,e){_.includes(this.callbackEventNames,t)&&(_.isArray(this._callbacks[t])?this._callbacks[t].push(e):this._callbacks[t]=[e])},this.triggerCallbacks=function(t,e){var n=this;_.isArray(this._callbacks[t])&&this._callbacks[t].forEach(function(t){t(n,e)})},this._clean=function(){var t=this,e=_.reduce(this._data,function(t,e,n){var a=e.data.length;return a>t?a:t},0);this._data.forEach(function(t,n){for(var a=t.data.length;e>a;a++)t.data.push(void 0)});var n=/(.*-)(\d*)/;_.each(t.getColumnHeaders(),function(e,a){var i=t.getColumnHeaders();for(i.splice(a,1);i.indexOf(e)>=0;){var r=n.exec(e);r&&3===r.length?t._data[a].header=e=r[1]+(Number(r[2])+1):t._data[a].header=e+="-1"}})},this._getRowsAsCellObjects=function(){return _.chain(this._data).map(function(t){return _.map(t.data,function(e){return{header:t.header,data:e}})}).zipArrays().value()},this._addRowCellObjects=function(t){var e=this,n=_.pluck(t,"header");this.addColumns(n,{silent:!0,ignoreDuplicates:!0}),t.forEach(function(t){e._addCell(t.header,t.data)}),this._clean()},this._addCell=function(t,e){var n=_.find(this._data,function(e){return e.header===t});n.data.push(e)},this._fixInterTableHeaderCollisions=function(t,e,n){var a=/(.*-)(\d*)/,i=t.getColumnHeaders(),r=e.getColumnHeaders();return _.chain(r).map(function(t){if(_.contains(n,t))return t;for(;i.indexOf(t)>=0;){var e=a.exec(t);e&&3===e.length?t=e[1]+(Number(e[2])+1):t+="-1"}return t}).each(function(t,n){e._data[n].header=t}).value(),e._clean(),t._clean(),[t,e]}}if("undefined"==typeof window){var _=require("lodash");module.exports=Taboo}